---
title: "Analyzing Student's Mental Health"
format: html
---

```{r}

# Load Libraries
library(DBI)       # Interface for database connections
library(RSQLite)   # SQLite backend for DBI
library(readr)     # Reading CSVs 

df <- read.csv("students.csv")  # Load student data from CSV into a data frame
con <- dbConnect(SQLite(), "students.db")  # Connect to a local SQLite database

dbWriteTable(con, "students", df, overwrite = TRUE)  # Write the data frame to a table named 'students'

```

```{r}
query <- "
/*
This query analyzes how length of stay impacts mental health scores
for international students. It returns:
- stay duration
- count of students
- average scores for PHQ-9, SCS, and ASISS
*/

SELECT stay, 
       COUNT(*) AS count_int,
       ROUND(AVG(todep), 2) AS average_phq, 
       ROUND(AVG(tosc), 2) AS average_scs, 
       ROUND(AVG(toas), 2) AS average_as
FROM students
WHERE inter_dom = 'Inter'
GROUP BY stay
ORDER BY stay DESC;
"

result <- dbGetQuery(con, query)  # Run the SQL query and store results in R

print(result)  # Display the summarized table
```
